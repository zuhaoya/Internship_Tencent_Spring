### Tars框架笔记

---

#### 微服务架构

> 早期的软件工程 单体架构（所有后台功能高度耦合在一起）
>
> ![img](D:\zuhaoya\Internship_Tencent_Spring\tars框架学习\图片\v2-1292f5a391142ac8da195787e28291bf_720w.jpg)
>
> 显然这里会出现很多问题：
>
> * 业务逻辑代码高度重复
> * 接口调用混乱
> * 应用边界模糊，功能归属混乱
> * 数据库瓶颈 
> * 后续开发、测试、部署、维护困难
> * 。。。

所以，我们需要一个梳理整体架构，抽象出公用的业务服务代码

![img](D:\zuhaoya\Internship_Tencent_Spring\tars框架学习\图片\v2-0882bc64f3f20939876d3433e51fad72_720w.jpg)

显然，服务分开了，但是数据库的瓶颈依然存在。

* 数据库仍然为性能瓶颈 
* 数据管理趋向混乱
* 数据库表结构会被多个服务依赖，牵一发而动全身

所以，我们还需要拆分数据库

![img](D:\zuhaoya\Internship_Tencent_Spring\tars框架学习\图片\v2-90388920d31fe35b791c6a92f758db18_720w.jpg)

但是即使是微服务架构，依然存在自己的问题。

* **微服务架构整个应用分散成多个服务，定位故障点非常困难**
* **稳定性下降，一个服务故障可能导致整个系统挂掉**
* 服务数量众多，部署、管理工作量太大
* 无法保证服务在持续开发的情况下，仍可以协同合作
* 测试复杂

所以我们需要一系列的服务。

**监控：发现故障的征兆**

首先，我们需要进一步建立完善的监控体系，但是很难写一个很大的服务来监控每个服务（每个服务需要监控的内容不大相同），于是，我们需要让各个组即服务自己提供报告自己当前状态的接口，然后通过部署指标采集器，获得这些状态。

![img](D:\zuhaoya\Internship_Tencent_Spring\tars框架学习\图片\v2-ab2479317923472e06d5f3e0b8943944_720w.jpg)

**定位服务 - 链路跟踪**

在微服务架构下，一个用户的请求往往涉及多个内部服务调用。为了方便定位问题，需要能够记录每个用户请求时，微服务内部产生了多少服务调用，及其调用关系。这个叫做链路跟踪。

**分析问题：日志分析**

日志分析组件应该在微服务兴起之前就被广泛使用了。即使单体应用架构，当访问数变大、或服务器规模增多时，日志文件的大小会膨胀到难以用文本编辑器进行访问，更糟的是它们分散在多台服务器上面。排查一个问题，需要登录到各台服务器去获取日志文件，一个一个地查找（而且打开、查找都很慢）想要的日志信息。

**网关：权限控制，服务治理**

在调用者和被调用者中间加一层网关，每次调用时进行权限校验。另外，网关也可以作为一个提供服务接口文档的平台

![img](D:\zuhaoya\Internship_Tencent_Spring\tars框架学习\图片\v2-84a6eee84a5dc3f2e97f56b4148bbc66_720w.jpg)

**服务注册于发现 - 动态扩容**

对于故障的处理，最粗暴也是最直接的方法是冗余，同个服务器部署多个实例。

新增实例的操作：部署新实例，将新实例注册到负载均衡/DNS上

